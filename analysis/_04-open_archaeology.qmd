---
bibliography: references.bib
---

# Open archaeology

<!-- Results I: description of open archaeology projects

- What kind of projects comprise open archaeology?
  x Breakdown of tags and categories
  x Breakdown of platforms and languages
  x Tags by category
  x Licenses?
- How has this changed over time?
  - Growth of open archaeology by number of commits
  - Growth of open archaeology by number of repos
  - Compare changing proportions of each category on a year by year basis
  - Identify periods associated with different rates of growth, and relate these with different general attitudes in the history of digital archaeology
-->

As of writing, open-archaeo catalogues `r nrow(oarch)` resources created by and for archaeologists.
It includes both software and documents, but not research compendiums.^[see [https://github.com/benmarwick/ctv-archaeology#publications-that-include-r-code](https://github.com/benmarwick/ctv-archaeology#publications-that-include-r-code) for a similar list of archaeology publications that include R code]
We annotated each record with categories and tags that describe what aspect of archaeological research each tool or resource was meant to address.
We categorized all records based on how each tool or resource is meant to be accessed or used, and assigned tags based on how developers identified their projects' purpose and scope.
See [@batist2023] for a more comprehensive overview of the tags and categories applied to open-archaeo.

```{r tbl-categories}
#| tbl-cap: Categories of open archaeology projects included in open-archaeo.
# TODO: Include sum for the "Software" and "Documents" supercategories, and make them appear in bold.
tribble(
  ~category,                               ~kind,       ~scope,
  "Packages and libraries",                "Software", "Sets of functions assembled with clear purpose, and made accessible using standards established by an underlying platform.",
  "Standalone software",                   "Software", "Software that may be operated without needing to first access an underlying platform.",
  "Scripts",                               "Software", "Sets of pragmatically assembled mutable functions, often lacking complete documentation or adherence to protocols that would otherwise facilitate secondary use outside their original contexts of creation.",
  "Specifications, protocols and schemas", "Documents", "A formal data structure or framework intended to be used as a model.",
  "Products",                              "Documents", "Stable outcomes of creative work.",
  "Guides",                                "Documents", "An educational resource or documented protocol meant to instruct readers how to apply relevant tools or techniques.",
  "Lists and datasets",                    "Documents", "A series of consistently organized observations assembled with purpose."
) |>
  left_join(oarch, by = "category") |>
  count(category, kind, scope) |>
  group_by(kind) |>
  arrange(-n) |>
  gt() |>
  cols_label_with(fn = tools::toTitleCase)
```

```{r num-p_platform}
p_platform <- sum(!is.na(oarch$platform)) / nrow(oarch)
```

In our breakdown of open-archaeo by category (see @tbl-categories), we demonstrate the pervasiveness of various development models, and the requisite technical capabilities that developers assume users hold.
Most resources (`r percent(p_platform)`) included in open-archaeo are designed to be used atop an existing "platform" -- for example a package that extends a programming language or a plugin for an application.
The designers of this code are basically creating additional functions within the base platform that are useful for archaeological purposes.
Others create standalone software <!-- percent --> that can be run independently of such platforms, for example desktop or web apps.
A significant number of projects also comprise of datasets <!-- percent --> and non-packaged code snippets <!-- percent --> that have been made available for general use.

```{r tbl-platforms}
#| tbl-cap: Platforms and programming languages used by open archaeology projects.
oarch |>
  drop_na(platform) |>
  count(platform) |>
  mutate(
    significant = n > 1,
    platform = if_else(significant, platform, "Other")
  ) |>
  group_by(platform) |>
  summarise(n = sum(n)) |>
  arrange(platform == "Other", -n) |>
  gt() |>
  cols_label_with(fn = tools::toTitleCase)
```

```{r num-p_platform_r}
p_platform_r <- sum(oarch$platform == "R", na.rm = TRUE) / nrow(oarch)
```

`r percent(p_platform_r)` of projects are extensions to the statistical programming language R, making it the most widely-used platform by a large margin (@tbl-platforms).
Python, another programming language, is also relatively popular <!-- TODO: percent -->, as are plugins for the open source geographic information system QGIS <!-- TODO: percent -->.
Beyond that, there is a rather fragmented landscape of plugins for other desktop software (e.g. AutoCAD, ArcGIS), a number of lesser used programming languages, and a genre consisting of custom forms and spreadsheet templates.
Many of these are targeted by only one or two developers; the larger platforms tend to be more diverse.

At first glance, the relative popularity of R versus Python is perhaps surprising; Python is regularly ranked as the most popular programming language in the world, with R a distant runner-up.
However, it accords with the popularity of R as a tool for data analysis in archaeology [@schmidt2020] and other scientific disciplines [@lai2019].

Our analysis of tags highlights aspects of archaeological work that software developers are inclined to contribute to [@fig-tags].
The most common tags unsurprisingly deal with work that naturally benefits from advanced information processing afforded by computers, such as statistical analysis, sample calibration, geographical analysis, data management, and chronological modelling.
Educational resources and practical guides are also well represented due to the web's usefulness as a medium for sharing and communication.

When we compare categories with tags, we see the general domains that each kind of resource is designed to serve.
We see that packages are fairly common across the board.
Tags that are notable for having a higher proportion of standalone software include archaeogenetics, data management, 3D modelling, photogrammetry, drivers and IO, and simulations or agent based modelling.
These tools may require greater access to system resources, or may require more complex user interfaces than are more complex than what R or Python IDEs (integrated development environments) tend to provide.

<!-- TODO: can we say anything more concrete about the tags? 
ZB response: We can look at the development of tags over time. For instance, a chart documenting year-over-year growth of each tag based on date of each project's first commit. I imagine this as a stacked bar chart (similar to below) but with segments coded to represent year of first commit. This would fit at the end of this section, under fog-github-cumulative. We can add charts documenting growth of platforms and licenses too. -->

```{r fig-tags}
#| fig-cap: Tags by category
oarch %>%
  pivot_longer(c(tag1, tag2, tag3, tag4, tag5), values_to = "tag",
               values_drop_na = TRUE) %>%
  drop_na(tag) %>%
  mutate(category = recode(category,
                                  "Specifications, protocols and schemas" = "Documents",
                                  "Products" = "Documents",
                                  "Guides" = "Documents",
                                  "Lists and datasets" = "Documents",
                                  .default = category)) %>%
  group_by(tag, category) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(total = sum(n)) %>%
  ggplot(aes(fct_reorder(tag, total), n, fill = category)) +
  geom_col() +
  scale_fill_bright() +
  coord_flip() +
  labs(
    x = NULL, y = "Number of projects",
    fill = NULL
  ) +
  theme_oarch() +
  theme(
    axis.text.y = element_text(size = 7)
  )
```

To enact their mandate of ensuring that anyone can access and modify software and other creative works, the open source and open science movements encourage developers and scientists to adopt open licenses.
Licenses are legally-binding statements that stipulate how a creative work can be accessed and used.
Proprietary licenses usually require explicit permission to be granted so that the work can be accessed or modified, usually in exchange for financial compensation.
Open licenses, on the other hand, are more permissive, and allow anyone to use creative works without such harsh restrictions.
While it is certainly possible to write your own license, it is very common to simply use one of several standardized open licenses (see [choosealicense.com](https://choosealicense.com for a more comprehensive overview of various options)).
Some licenses, like GNU, MIT and Apache, are explicitly suited for distributing software, and specify certain use cases that are afforded by digital media.
Other licenses, like the Creative Commons variants, are more suited to other kinds of creative works like books, articles, movies, music, photographs, and websites.
The Creative Commons licenses also include clauses that cater to academic or creative sensibilities, such as requirements to attribute credit to the original authors, to restrict commercial use, and to propagate similar restrictions in derivative works.

```{r data-licenses}
oarch_licenses <- read_csv(here("analysis/data/raw_data/open-archaeo_licenses.csv"))
oarch_licenses |>
  select(gh_repo = url, other_license = license) |>
  right_join(oarch, by = "gh_repo") |>
  hoist(gh_repo_info, license = list("license", 1, "spdx_id")) |>
  mutate(license = if_else(license == "NOASSERTION", other_license, license)) |>
  select(-other_license) ->
  oarch

p_license_gpl <- n_filter(oarch, str_detect(license, "GPL")) / n_filter(oarch, !is.na(license))
p_license_mit <- n_filter(oarch, str_detect(license, "MIT")) / n_filter(oarch, !is.na(license))
p_license_cc <- n_filter(oarch, str_detect(license, "CC")) / n_filter(oarch, !is.na(license))
```

```{r tbl-repo-licenses}
#| tbl-cap: Summary of licenses used by projects with GitHub repositories
# TODO: group small categories into "other"
oarch |>
  mutate(license = str_remove(license, "-?\\d\\.\\d$")) |>
  count(license) |>
  mutate(license = replace_na(license, "None detected")) |>
  arrange(-n) |>
  gt() |>
    cols_label(license = "License", n = "N")
```

Roughly half of open-archaeo repositories are accompanied by an explicit license [@tbl-repo-licenses].
Two common free software licenses account for the majority of these: the GNU General Public License (GPL, `r percent(p_license_gpl)`) and the MIT License (`r percent(p_license_mit)`).
These differ primarily in the restrictions they place on reuse: the MIT License aims to be maximally permissive, while the GPL is a 'copyleft' license that specifies that all derivative works must be distributed under similar terms (in other words, it prohibits the use of FOSS software within non-FOSS software, [@dusollier2007]).
Archaeologists' preference for the more restrictive of these two licenses is the reverse of the general trend seen in open source projects on GitHub [@balter2015].
Creative Commons licenses are a distant third place (`r percent(p_license_cc)` of repositories), in contrast to their widespread use for other forms of scholarly output [@kim2007].
Many repositories do not specify a license; given a documented misconception among academics that GitHub can serve as a sustainable and long-term code and data hosting platform [@milliken2021; @escamilla2022; @escamilla2023], it is possible that many maintainers whose work is included in open-archaeo similarly assumed that making their work available, without explicitly stating permissible use, is enough to allow unrestricted access to the repository's contents.
However, we can not verify this potential explanation given the methods we currently employ, and more discursive qualitative research is needed to explore the rationales behind such decisions.

Archaeological software development activity has increased significantly over the years.
@fig-github-cumulative shows the cumulative growth of code contributions committed and pushed to GitHub repositories, and the number of GitHub repositories that host archaeological software and resources.

```{r fig-github-cumulative}
#| fig-cap: Cumulative growth of open archaeological software in terms of number of commits and number of repositories, and broken down by category.
oarch %>% 
  mutate(
    lumped_category = recode(category,
                             "Specifications etc." = "Documents",
                             "Products" = "Documents",
                             "Guides" = "Documents",
                             "Lists and datasets" = "Documents",
                             .default = category),
    lumped_category = factor(lumped_category, c("Scripts",
                                                "Documents",
                                                "Packages and libraries",
                                                "Standalone software")) ) ->
  oarch_lumped

p_gh_commits_cum <- oarch_lumped %>%
  unnest(gh_commits) %>%
  drop_na(sha) %>%
  mutate(date = floor_date(datetime, "week")) %>%
  group_by(lumped_category, date) %>%
  summarise(n_commits = n(), .groups = "drop_last") %>%
  mutate(cum_commits = cumsum(n_commits)) %>%
  ggplot(aes(date, cum_commits,
             fill = lumped_category,
             colour = lumped_category,
             label = lumped_category)) +
  geom_area() +
  annotate("segment", 
           x = ymd("2008-04-01", tz = "UTC"), 
           xend = ymd("2008-04-01", tz = "UTC"),
           y = 16000, yend = 4000,
           arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
  annotate("text", 
           x = ymd("2008-04-01", tz = "UTC"), y = 19000,
           label = "GitHub\nlaunched",
           vjust = 0) +
  scale_x_datetime(date_breaks = "2 years", date_labels = "%Y") +
  scale_y_continuous(labels = scales::comma) +
  scale_colour_bright(guide = guide_none()) +
  scale_fill_bright() +
  labs(
    y = "cumulative commits",
    x = NULL, fill = NULL
  ) +
  theme_oarch() +
  theme(legend.position = "top")

# TODO: extend to end
p_gh_repos_cum <- oarch_lumped %>%
  unnest(gh_commits) %>%
  drop_na(sha) %>%
  group_by(repo) %>% 
  filter(datetime == min(datetime)) %>% # Only first commits
  mutate(date = floor_date(datetime, "week")) %>%
  group_by(lumped_category, date) %>%
  summarise(n_commits = n(), .groups = "drop_last") %>%
  mutate(cat_total = sum(n_commits)) %>%
  mutate(cum_commits = cumsum(n_commits)) %>%
  ggplot(aes(date, cum_commits,
             fill = lumped_category,
             colour = lumped_category)) +
  geom_area() +
  annotate("segment",
           x = ymd("2008-04-01", tz = "UTC"),
           xend = ymd("2008-04-01", tz = "UTC"),
           y = 40, yend = 10,
           arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
  annotate("text",
           x = ymd("2008-04-01", tz = "UTC"), y = 50,
           label = "GitHub\nlaunched",
           vjust = 0) +
  scale_x_datetime(date_breaks = "2 years", date_labels = "%Y") +
  scale_y_continuous(labels = scales::comma) +
  scale_colour_bright(guide = guide_none()) +
  scale_fill_bright(guide = guide_none()) +
  labs(
    y = "cumulative repositories",
    x = NULL, fill = NULL
  ) +
  theme_oarch()

p_gh_commits_cum / p_gh_repos_cum
```

As we can see, archaeologists have been using git from even before GitHub was launched in 2008.
But use of git really began to take off around 2014--2015, when we see an uptick in the rate of growth that has continued ever since.

Around this time we also see that GitHub starts being used to host documents and scripts.
This may represent a recognition of GitHub's ability to track things other than code, and a willingness to experiment with version control systems as a medium for disseminating work in an open and somewhat nerdy way.

